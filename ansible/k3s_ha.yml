---

- hosts: k3s_cluster # defines what hosts to install this role on
  gather_facts: yes
#  become: yes # use sudo
  vars:
    molecule_is_test: true
#    k3s_control_node_address: loadbalancer
    k3s_datastore_endpoint: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32383036353530626663336135353163393564353061623534636435323364376462323139343964
          3431656561626638656363633564633739666634313761650a376431373965343763316564376231
          31373635623333313333316135363936383264633266303736363361626262313630613430616131
          6563623632623864620a663734396539346266373739303139396230663236393062663230623336
          64303563613632643837353735666633316533636461393964363333393262363537616538373136
          31396530313936643061386230663130356230323237353739353331636636346564346334633738
          303939363330633538653839616638343038
#    k3s_datastore_endpoint: "mysql://marx:xxx@tcp(192.168.1.151:3307)/k3s"
  pre_tasks:
    - name: Set each node to be a control node
      set_fact:
        k3s_control_node: true
  #      when: inventory_hostname in ['node2', 'node3']
  roles:
    - role: common
    - role: xanmanning.k3s
