---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: postgrest
  namespace: pfire
spec:
  interval: 15m
  chart:
    spec:
      chart: postgrest
      version: 0.3.5
      sourceRef:
        kind: HelmRepository
        name: postgrest-charts
        namespace: flux-system
  values:
    image:
      repository: postgrest/postgrest
      #      tag: 11.2.0
      pullPolicy: IfNotPresent
    ingress:
      enabled: true
      annotations:
        hajimari.io/enable: "true"
        hajimari.io/icon: "weather-sunset"
        hajimari.io/group: "pfire"
        kubernetes.io/ingress.class: nginx
      hosts:
        - host: postgrest.${SECRET_DOMAIN}
          paths:
            - path: /
              pathType: Prefix
      tls:
        - hosts:
            - "postgrest.${SECRET_DOMAIN}"

    # http://postgrest.org/en/v4.3/install.html#configuration
    # https://github.com/colearendt/helm/blob/main/charts/postgrest/values.yaml
    postgrest:
      # -- The dbUri for connecting to the database. Required
      dbUri: "postgres://postgres:${SECRET_POSTGRESQL_PASS}@postgresql:5432/stooq"
      dbSchema: "public"
      # -- The JWT Secret used for constructing JWTs. Required
      jwtSecret: "mrt3g309vhfdsvrebgredfwgwf4gff4t5ytg6h5g"